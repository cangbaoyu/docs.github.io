<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://www.sansei.top/exambook/Java-Design-Model1.html"><meta property="og:site_name" content="川上富江"><meta property="og:title" content="说说常用开源框架中设计模式使用分析"><meta property="og:description" content="说说常用开源框架中设计模式使用分析 一、前言 设计模式代表了软件设计的最佳实践，是经过不断总结提炼出来的代码设计经验的分类总结，这些模式或者可以简化代码，或者可以是代码逻辑开起来清晰，或者对功能扩展很方便 设计模式按照使用场景可以分为三大类： 创建型模式（Creational Patterns）：对对象的实例化过程进行抽象，这使得一个系统可以不用关心这..."><meta property="og:type" content="article"><meta property="og:image" content="http://114.116.184.67:81/images/designmodel/5879294-bf812e77605ba1a3.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-08-30T14:18:24.000Z"><meta property="article:modified_time" content="2024-08-30T14:18:24.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"说说常用开源框架中设计模式使用分析","image":["http://114.116.184.67:81/images/designmodel/5879294-bf812e77605ba1a3.png","http://114.116.184.67:81/images/designmodel/5879294-51ec28c227c785bd.png","http://114.116.184.67:81/images/designmodel/5879294-a7ecb943aa15c858.png","http://114.116.184.67:81/images/designmodel/5879294-2d102832375148ef.png","http://114.116.184.67:81/images/designmodel/5879294-3013e4bf12ef0274.png","http://114.116.184.67:81/images/designmodel/5879294-24f08d52b6fc7fba.png","http://114.116.184.67:81/images/designmodel/5879294-7e0b0badc2deef53.png","http://114.116.184.67:81/images/designmodel/5879294-2ef6c46b46d18914.png","http://114.116.184.67:81/images/designmodel/5879294-66c15140bfe5ad36.png","http://114.116.184.67:81/images/designmodel/5879294-f9a9a083d138e9d0.png","http://114.116.184.67:81/images/designmodel/5879294-cab488a963d04657.png","http://114.116.184.67:81/images/designmodel/5879294-afa39758e0c2213d.png","http://114.116.184.67:81/images/designmodel/5879294-5eacbfe80fc60237.png","http://114.116.184.67:81/images/designmodel/5879294-072d44bda8af7ef9.png","http://114.116.184.67:81/images/designmodel/5879294-27b737718c1a71bc.png","http://114.116.184.67:81/images/designmodel/5879294-d5e4f335d709ab29.png","http://114.116.184.67:81/images/designmodel/5879294-bd4bb3f72e7da976.png","http://114.116.184.67:81/images/designmodel/5879294-96342ae1a578c8c6.png","http://114.116.184.67:81/images/designmodel/5879294-eee8a0c0437a83d5.png","http://114.116.184.67:81/images/designmodel/5879294-f9e90281b20fe688.png"],"dateModified":"2024-08-30T14:18:24.000Z","author":[]}</script><title>说说常用开源框架中设计模式使用分析 | 川上富江</title><meta name="description" content="说说常用开源框架中设计模式使用分析 一、前言 设计模式代表了软件设计的最佳实践，是经过不断总结提炼出来的代码设计经验的分类总结，这些模式或者可以简化代码，或者可以是代码逻辑开起来清晰，或者对功能扩展很方便 设计模式按照使用场景可以分为三大类： 创建型模式（Creational Patterns）：对对象的实例化过程进行抽象，这使得一个系统可以不用关心这...">
    <link rel="stylesheet" href="/assets/css/styles.ed1ea483.css">
    <link rel="preload" href="/assets/js/runtime~app.e84162b8.js" as="script"><link rel="preload" href="/assets/css/styles.ed1ea483.css" as="style"><link rel="preload" href="/assets/js/4893.6b2ef6da.js" as="script"><link rel="preload" href="/assets/js/app.bb7342ad.js" as="script">
    <link rel="prefetch" href="/assets/js/exambook_Java-Design-Model1.html.3df83142.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_index.html.d516dc45.js" as="script"><link rel="prefetch" href="/assets/js/1810.2e25d71c.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_中间件搭建.html.4d9e8884.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_虚拟机系统的配置.html.75127182.js" as="script"><link rel="prefetch" href="/assets/js/photo-swipe.e3ee2e95.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model6.html.fa031aa3.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_IDEA安装与配置.html.929fc2cc.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_GIT命令使用手册.html.a615416f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service9.html.67c22483.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_私服搭建.html.03e4d180.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service5.html.2bfef1e7.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service8.html.8e532654.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service12.html.d8dd295e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed3.html.9509ce25.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_Linux单独节点配置.html.18b18ce4.js" as="script"><link rel="prefetch" href="/assets/js/giscus.6f22895a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Performance3.html.7d069243.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed5.html.2917f17f.js" as="script"><link rel="prefetch" href="/assets/js/guide_markdown.html.a4d8c879.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability3.html.db9fa16b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed4.html.a7395e87.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed4.html.41c0ca90.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability5.html.e2b5b2c7.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_Fiddler安装及使用.html.f3e14d5b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed1.html.0fabcffe.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_搭建SonarQube代码质量检测平台.html.f1521acd.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql6.html.32632f33.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security5.html.9cb8cc54.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service6.html.43e33817.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed5.html.bdd19d22.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security2.html.3f12b627.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security7.html.9817374d.js" as="script"><link rel="prefetch" href="/assets/css/3616.styles.a6782cab.css" as="style"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability4.html.9397ad4a.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_object.html.e2d6504d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge1.html.d7995dd0.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security4.html.79a44dd4.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis3.html.ec992d51.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability1.html.d2fb9ede.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_install-docker-compose.html.39357c95.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql1.html.a06fb0d7.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_symbol.html.708c48aa.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge4.html.cf7e66a2.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model2.html.678f5519.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_spring-cloud-netflix.html.631a31a5.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_install-ubuntu-server.html.39a9e868.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_people.html.2eaa0620.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service11.html.3703e0e5.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security6.html.6786a5f3.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service7.html.1d219946.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model3.html.4fb09524.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ3.html.a4db8b15.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model4.html.7f29e9e9.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Performance2.html.b511fb5c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql12.html.d8ddfafe.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service3.html.d7353778.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security3.html.7914d219.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Performance1.html.8fbf5ac2.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Model5.html.cfc95b6c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql4.html.a46a6a21.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql2.html.53532c00.js" as="script"><link rel="prefetch" href="/assets/js/guide_page.html.cb04f9ae.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis8.html.6a29ce23.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql5.html.84e0da79.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Security1.html.3a0df42d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread1.html.b35d0c25.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_nature.html.daa3bff3.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread2.html.9055e22a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service13.html.ba87c339.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service1.html.08a3d33d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed2.html.e520b403.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_place.html.7508abca.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics10.html.c4095133.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability2.html.bceccb93.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge5.html.59bdfb14.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_index.html.9f15fdcf.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring6.html.d722009d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Distributed1.html.1d4b640d.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_Chrome插件安装时程序包无效.html.d6292e4d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge2.html.caea6252.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_SpringBoot-整合Thymeleaf.html.8c519592.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_apache-dubbo.html.28b0f965.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed2.html.2e9ac0ff.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring4.html.6ab6e0d1.js" as="script"><link rel="prefetch" href="/assets/js/guide_index.html.1dcc9966.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking4.html.a5b497d3.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_linux_index.html.6fe87212.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service4.html.c34e4253.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql3.html.121c807f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Other-Case.html.22c13c5c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics1.html.ab7655ab.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread10.html.04385f6a.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_spring-cloud-alibaba.html.850d8c20.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics4.html.fd399632.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service10.html.16bef930.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List3.html.9be87358.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql13.html.e2696e97.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql10.html.b5a95a0a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service14.html.257eb14a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics6.html.62357e3d.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql9.html.00e3cf3e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ4.html.f1e0a8a6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List5.html.6d0ad767.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Design-Ability6.html.2421daeb.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Service2.html.c115dade.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics7.html.0612c9f4.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking7.html.d9ebbdc6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql8.html.287b7c2b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking5.html.3843c0ee.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking6.html.8a0b1c39.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql7.html.87d7af1a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread9.html.d61c9b68.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics8.html.780d723b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics5.html.d9c31b9c.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_vue_Vue前端框架体系.html.338692f5.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring1.html.0098adc2.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis5.html.fe60faf4.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics2.html.79ae31ca.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty5.html.1b73d03c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty1.html.7f57b8c9.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis2.html.5ce9abd5.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_vue_index.html.9bc99006.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty8.html.d45a4f0f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring2.html.0db744f8.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics12.html.04379f57.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql14.html.158ab275.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring5.html.30a21464.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring11.html.3bfbe0aa.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring3.html.c908e05c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql15.html.78bc69ac.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty2.html.6ed6ccc1.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis6.html.c62e9826.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics3.html.97c0a599.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ2.html.f6f5148b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ5.html.3f99d1c6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking1.html.59bef526.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List2.html.c3eaa799.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking2.html.389de533.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List7.html.936e72a2.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread6.html.f4acd247.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty4.html.2ed4e02e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring7.html.1f9e1338.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List8.html.025dd8d6.js" as="script"><link rel="prefetch" href="/assets/js/guide_encrypt.html.46f0f44a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics9.html.47705282.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List4.html.15e03ec0.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty6.html.836b204a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring8.html.2563329e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List1.html.f1472667.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread3.html.30b34dd4.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ1.html.6ff5c103.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics13.html.22434f6f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty3.html.0ca0b4f5.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread5.html.d697b9bd.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List9.html.6f4d3628.js" as="script"><link rel="prefetch" href="/assets/js/guide_disable.html.712e0b82.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_spring-security-oauth2.html.c092920f.js" as="script"><link rel="prefetch" href="/assets/js/exambook_javabasics11.html.8ae02960.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread7.html.4fa9a78f.js" as="script"><link rel="prefetch" href="/assets/js/index.html.f6e7c2e9.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-MQ6.html.e2dbde0c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring9.html.c6be12a5.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty7.html.3795e106.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-AnalNeed3.html.6ebbe346.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread8.html.5c4a75f0.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread4.html.7a23c18c.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis7.html.835f6da6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-List6.html.e628530a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Locking3.html.40bc99ee.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Mysql11.html.bab84543.js" as="script"><link rel="prefetch" href="/assets/js/exambook_knowledge3.html.bd7d2a4e.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis9.html.10048614.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Spring10.html.e94515c0.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis4.html.76710f0a.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Redis1.html.c7231319.js" as="script"><link rel="prefetch" href="/assets/js/exambook_index.html.5c1556e6.js" as="script"><link rel="prefetch" href="/assets/js/exambook_补充知识点.html.5564ba4b.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Thread11.html.71e34978.js" as="script"><link rel="prefetch" href="/assets/js/exambook_Java-Netty9.html.b7263af3.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_SpringBoot-钉钉机器人通知群功能.html.9ef8a25e.js" as="script"><link rel="prefetch" href="/assets/js/notebook_index.html.c516c039.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_index.html.646da692.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_SpringBoot-整合MyBatis.html.af177e7f.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springboot_SpringBoot-整合Quartz.html.1d458ce0.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_index.html.07756c82.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_servicemesh_index.html.9bf6e1ba.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_openplatform_index.html.54ebf4d4.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_springcloud_index.html.2e1174c8.js" as="script"><link rel="prefetch" href="/assets/js/knowledge_ai_index.html.92338a5b.js" as="script"><link rel="prefetch" href="/assets/js/devops_basic_windows_index.html.06fd7504.js" as="script"><link rel="prefetch" href="/assets/js/devops_markdown_emoji_index.html.11c81856.js" as="script"><link rel="prefetch" href="/assets/js/devops_index.html.1e3a208f.js" as="script"><link rel="prefetch" href="/assets/js/404.html.c1161908.js" as="script"><link rel="prefetch" href="/assets/css/1058.styles.3ca50afa.css" as="style"><link rel="prefetch" href="/assets/js/7402.b22a97a9.js" as="script"><link rel="prefetch" href="/assets/js/8264.f052fd25.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">川上富江</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/guide/" aria-label="指南"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->指南<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/knowledge/" aria-label="知识库"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-splotch" style=""></span><!--]-->知识库<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/notebook/" aria-label="笔记系列"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-book-open" style=""></span><!--]-->笔记系列<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/exambook/" aria-label="面试宝典"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-question" style=""></span><!--]-->面试宝典<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="运维相关"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>运维相关<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">基础设施</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/devops/basic/windows/" aria-label="Windows 系列"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-gear" style=""></span><!--]-->Windows 系列<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/devops/basic/linux/" aria-label="Linux 系列"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-gear" style=""></span><!--]-->Linux 系列<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">高级</h4><ul class="vp-dropdown-subitems"></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/cangbaoy/docs.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/" aria-label="面试宝典"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-question" style=""></span><!--]-->面试宝典<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model3.html" aria-label="23 种设计模式的设计理念"><!---->23 种设计模式的设计理念<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql1.html" aria-label="58 到家 MySQL 军规升级版"><!---->58 到家 MySQL 军规升级版<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking6.html" aria-label="ABA 问题"><!---->ABA 问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List3.html" aria-label="ArrayList 与 LinkedList 区别"><!---->ArrayList 与 LinkedList 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List4.html" aria-label="ArrayList 与 Vector 区别"><!---->ArrayList 与 Vector 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring1.html" aria-label="BeanFactory 和 ApplicationContext 有什么区别"><!---->BeanFactory 和 ApplicationContext 有什么区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service7.html" aria-label="CAP 定理、 BASE 理论"><!---->CAP 定理、 BASE 理论<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking5.html" aria-label="CAS 乐观锁"><!---->CAS 乐观锁<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List9.html" aria-label="ConcurrentHashMap 的工作原理及代码实现"><!---->ConcurrentHashMap 的工作原理及代码实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql15.html" aria-label="ElasticSearch 使用场景"><!---->ElasticSearch 使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics13.html" aria-label="equals 与 == 的区别"><!---->equals 与 == 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics2.html" aria-label="final, finally, finalize 的区别"><!---->final, finally, finalize 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List7.html" aria-label="HashMap 和 ConcurrentHashMap 的区别"><!---->HashMap 和 ConcurrentHashMap 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List5.html" aria-label="HashMap 和 HashTable 的区别"><!---->HashMap 和 HashTable 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List8.html" aria-label="HashMap 的工作原理及代码实现"><!---->HashMap 的工作原理及代码实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List6.html" aria-label="HashSet 和 HashMap 区别"><!---->HashSet 和 HashMap 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics8.html" aria-label="HTTP 请求的 GET 与 POST 方式的区别"><!---->HTTP 请求的 GET 与 POST 方式的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security4.html" aria-label="HTTPS 原理剖析"><!---->HTTPS 原理剖析<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security5.html" aria-label="HTTPS 降级攻击"><!---->HTTPS 降级攻击<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics3.html" aria-label="int 和 Integer 有什么区别"><!---->int 和 Integer 有什么区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics11.html" aria-label="JDBC 流程"><!---->JDBC 流程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql10.html" aria-label="limit 20000 加载很慢怎么解决"><!---->limit 20000 加载很慢怎么解决<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List2.html" aria-label="List 和 Map 区别"><!---->List 和 Map 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-List1.html" aria-label="List 和 Set 区别"><!---->List 和 Set 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql13.html" aria-label="MongoDB 使用场景"><!---->MongoDB 使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics12.html" aria-label="MVC 设计思想"><!---->MVC 设计思想<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge4.html" aria-label="MySQL 优化"><!---->MySQL 优化<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql7.html" aria-label="MySQL 遇到的死锁问题"><!---->MySQL 遇到的死锁问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty8.html" aria-label="Netty 内部执行流程"><!---->Netty 内部执行流程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty6.html" aria-label="Netty 线程模型"><!---->Netty 线程模型<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty9.html" aria-label="Netty 重连实现"><!---->Netty 重连实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis7.html" aria-label="Redis 为什么是单线程的"><!---->Redis 为什么是单线程的<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis4.html" aria-label="Redis 使用场景"><!---->Redis 使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis3.html" aria-label="Redis 内存淘汰机制"><!---->Redis 内存淘汰机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis2.html" aria-label="Redis 内部结构"><!---->Redis 内部结构<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis5.html" aria-label="Redis 持久化机制"><!---->Redis 持久化机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis1.html" aria-label="Redis 有哪些类型"><!---->Redis 有哪些类型<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis6.html" aria-label="Redis 集群方案与实现"><!---->Redis 集群方案与实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics9.html" aria-label="session 与 cookie 区别"><!---->session 与 cookie 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics10.html" aria-label="session 分布式处理"><!---->session 分布式处理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed2.html" aria-label="Session 分布式方案"><!---->Session 分布式方案<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread2.html" aria-label="sleep()、join（）、yield（）有什么区别"><!---->sleep()、join（）、yield（）有什么区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring2.html" aria-label="Spring Bean 的生命周期"><!---->Spring Bean 的生命周期<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring3.html" aria-label="Spring IOC 如何实现"><!---->Spring IOC 如何实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring9.html" aria-label="Spring MVC 启动流程"><!---->Spring MVC 启动流程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring8.html" aria-label="Spring MVC 运行流程"><!---->Spring MVC 运行流程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring5.html" aria-label="Spring 事务实现方式"><!---->Spring 事务实现方式<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring6.html" aria-label="Spring 事务底层原理"><!---->Spring 事务底层原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring11.html" aria-label="Spring 框架中用到了哪些设计模式"><!---->Spring 框架中用到了哪些设计模式<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring10.html" aria-label="Spring 的单例实现原理"><!---->Spring 的单例实现原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql6.html" aria-label="SQL 优化之道"><!---->SQL 优化之道<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking3.html" aria-label="synchronize 实现原理"><!---->synchronize 实现原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking4.html" aria-label="synchronized 与 lock 的区别"><!---->synchronized 与 lock 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty5.html" aria-label="TCP 粘包/拆包的解决办法"><!---->TCP 粘包/拆包的解决办法<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread8.html" aria-label="ThreadLocal 原理分析"><!---->ThreadLocal 原理分析<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking2.html" aria-label="volatile 实现原理"><!---->volatile 实现原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge3.html" aria-label="Zookeeper 假死脑裂"><!---->Zookeeper 假死脑裂<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty1.html" aria-label="为什么选择 Netty"><!---->为什么选择 Netty<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking7.html" aria-label="乐观锁的业务场景及实现方式"><!---->乐观锁的业务场景及实现方式<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service4.html" aria-label="什么是 RESTful"><!---->什么是 RESTful<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service3.html" aria-label="什么是 RPC 框架"><!---->什么是 RPC 框架<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty4.html" aria-label="什么是 TCP 粘包/拆包"><!---->什么是 TCP 粘包/拆包<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring4.html" aria-label="什么是Spring AOP"><!---->什么是Spring AOP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql3.html" aria-label="什么是反模式设计"><!---->什么是反模式设计<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability5.html" aria-label="你如何划分领域边界"><!---->你如何划分领域边界<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed1.html" aria-label="你如何对需求原型进行理解和拆分"><!---->你如何对需求原型进行理解和拆分<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed5.html" aria-label="你如何理解用户痛点"><!---->你如何理解用户痛点<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability3.html" aria-label="你如何考虑服务化"><!---->你如何考虑服务化<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability2.html" aria-label="你如何考虑组件化"><!---->你如何考虑组件化<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability4.html" aria-label="你如何进行领域建模"><!---->你如何进行领域建模<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed4.html" aria-label="你针对产品提出哪些交互和改进意见"><!---->你针对产品提出哪些交互和改进意见<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis9.html" aria-label="使用缓存的合理性问题"><!---->使用缓存的合理性问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql14.html" aria-label="倒排索引"><!---->倒排索引<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service9.html" aria-label="最终一致性的实现方案"><!---->最终一致性的实现方案<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed4.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed3.html" aria-label="分布式锁的场景与实现"><!---->分布式锁的场景与实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql5.html" aria-label="分库与分表带来的分布式困境与应对之策"><!---->分库与分表带来的分布式困境与应对之策<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql4.html" aria-label="分库与分表设计"><!---->分库与分表设计<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread1.html" aria-label="创建线程的方式及实现"><!---->创建线程的方式及实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service1.html" aria-label="前后端分离是如何做的"><!---->前后端分离是如何做的<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty3.html" aria-label="原生的 NIO 在 JDK 1.7 版本存在 EPoll BUG"><!---->原生的 NIO 在 JDK 1.7 版本存在 EPoll BUG<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge1.html" aria-label="双亲委派模型"><!---->双亲委派模型<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security7.html" aria-label="基于角色的访问控制"><!---->基于角色的访问控制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ6.html" aria-label="如何保证消息的有序性"><!---->如何保证消息的有序性<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Performance2.html" aria-label="如何发现性能瓶颈"><!---->如何发现性能瓶颈<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service13.html" aria-label="如何应对微服务的链式调用异常"><!---->如何应对微服务的链式调用异常<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service11.html" aria-label="如何拆分服务"><!---->如何拆分服务<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service6.html" aria-label="如何理解 RESTful API 的幂等性"><!---->如何理解 RESTful API 的幂等性<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Spring7.html" aria-label="如何自定义注解实现功能"><!---->如何自定义注解实现功能<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service5.html" aria-label="如何设计一个良好的 API"><!---->如何设计一个良好的 API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql8.html" aria-label="存储引擎的 InnoDB 与 MyiSAM"><!---->存储引擎的 InnoDB 与 MyiSAM<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security1.html" aria-label="安全要素与 STRIDE 威胁"><!---->安全要素与 STRIDE 威胁<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service10.html" aria-label="微服务与 SOA 的区别"><!---->微服务与 SOA 的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service2.html" aria-label="微服务哪些框架"><!---->微服务哪些框架<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service12.html" aria-label="微服务如何进行数据库管理"><!---->微服务如何进行数据库管理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service14.html" aria-label="微服务的安全"><!---->微服务的安全<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Service8.html" aria-label="怎么考虑数据一致性问题"><!---->怎么考虑数据一致性问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Performance1.html" aria-label="性能指标有哪些"><!---->性能指标有哪些<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Performance3.html" aria-label="性能调优的常见手段"><!---->性能调优的常见手段<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics5.html" aria-label="抽象类和接口有什么区别"><!---->抽象类和接口有什么区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security6.html" aria-label="授权与认证"><!---->授权与认证<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge5.html" aria-label="数据库的分库分表"><!---->数据库的分库分表<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql2.html" aria-label="数据库索引的原理与使用事项"><!---->数据库索引的原理与使用事项<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security3.html" aria-label="服务端通信安全攻防"><!---->服务端通信安全攻防<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Other-Case.html" aria-label="概述"><!---->概述<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/knowledge2.html" aria-label="死信、延迟、重试队列"><!---->死信、延迟、重试队列<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ4.html" aria-label="消息的堆积解决思路"><!---->消息的堆积解决思路<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ3.html" aria-label="消息的幂等性解决思路"><!---->消息的幂等性解决思路<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ2.html" aria-label="消息的重发补偿解决思路"><!---->消息的重发补偿解决思路<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ1.html" aria-label="消息队列的使用场景"><!---->消息队列的使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Locking1.html" aria-label="线程安全问题"><!---->线程安全问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread10.html" aria-label="线程池的几种方式与使用场景"><!---->线程池的几种方式与使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread11.html" aria-label="线程的生命周期"><!---->线程的生命周期<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Redis8.html" aria-label="缓存崩溃 与 缓存降级"><!---->缓存崩溃 与 缓存降级<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql9.html" aria-label="聚集索引与非聚集索引的区别"><!---->聚集索引与非聚集索引的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-MQ5.html" aria-label="自己如何实现消息队列"><!---->自己如何实现消息队列<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86%E7%82%B9.html" aria-label="补充知识点"><!---->补充知识点<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread9.html" aria-label="讲讲线程池的实现原理"><!---->讲讲线程池的实现原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model4.html" aria-label="设计模式之间的异同，例如策略模式与状态模式的区别"><!---->设计模式之间的异同，例如策略模式与状态模式的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model5.html" aria-label="设计模式之间的结合，例如策略模式 + 简单工厂模式的实践"><!---->设计模式之间的结合，例如策略模式 + 简单工厂模式的实践<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model6.html" aria-label="设计模式的性能，例如单例模式哪种性能更好"><!---->设计模式的性能，例如单例模式哪种性能更好<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread7.html" aria-label="说说 CountDownLatch 与 CyclicBarrier 区别"><!---->说说 CountDownLatch 与 CyclicBarrier 区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread3.html" aria-label="说说 CountDownLatch 原理"><!---->说说 CountDownLatch 原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread4.html" aria-label="说说 CyclicBarrier 原理"><!---->说说 CyclicBarrier 原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread6.html" aria-label="说说 Exchanger 原理"><!---->说说 Exchanger 原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty7.html" aria-label="说说 Netty 的零拷贝"><!---->说说 Netty 的零拷贝<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Thread5.html" aria-label="说说 Semaphore 原理"><!---->说说 Semaphore 原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Netty2.html" aria-label="说说业务中 Netty 的使用场景"><!---->说说业务中 Netty 的使用场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability1.html" aria-label="说说你在项目中使用过的 UML 图"><!---->说说你在项目中使用过的 UML 图<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed2.html" aria-label="说说你对功能性需求的理解"><!---->说说你对功能性需求的理解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Model2.html" aria-label="说说你对设计原则的理解"><!---->说说你对设计原则的理解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-AnalNeed3.html" aria-label="说说你对非功能性需求的理解"><!---->说说你对非功能性需求的理解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics6.html" aria-label="说说反射的用途及实现"><!---->说说反射的用途及实现<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/exambook/Java-Design-Model1.html" aria-label="说说常用开源框架中设计模式使用分析"><!---->说说常用开源框架中设计模式使用分析<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Design-Ability6.html" aria-label="说说概要设计"><!---->说说概要设计<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics7.html" aria-label="说说自定义注解的场景及实现"><!---->说说自定义注解的场景及实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed1.html" aria-label="谈谈业务中使用分布式的场景"><!---->谈谈业务中使用分布式的场景<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql11.html" aria-label="选择合适的分布式主键方案"><!---->选择合适的分布式主键方案<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Mysql12.html" aria-label="选择合适的数据存储方案"><!---->选择合适的数据存储方案<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics4.html" aria-label="重载和重写的区别"><!---->重载和重写的区别<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Security2.html" aria-label="防范常见的 Web 攻击"><!---->防范常见的 Web 攻击<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/Java-Distributed5.html" aria-label="集群与负载均衡的算法与实现"><!---->集群与负载均衡的算法与实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/exambook/javabasics1.html" aria-label="面向对象的特征"><!---->面向对象的特征<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->说说常用开源框架中设计模式使用分析</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-08-30T14:18:24.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 18 分钟</span><meta property="timeRequired" content="PT18M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#一、前言">一、前言</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#二、责任链设计模式-chain-of-responsibility-pattern">二、责任链设计模式（Chain of Responsibility Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tomcat-中-valve-链">Tomcat 中 Valve 链</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tomcat-中-filter-链">Tomcat 中 Filter 链</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#三、工厂模式-factory-pattern">三、工厂模式（Factory Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-1">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-框架中-beanfactory">Spring 框架中 BeanFactory</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#举个例子">举个例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-1">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#四、单例设计模式-singleton-pattern">四、单例设计模式（Singleton Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-2">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-中单例-bean-的创建">Spring 中单例 Bean 的创建</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-2">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#五、原型设计模式-prototype-pattern">五、原型设计模式（Prototype Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-3">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-中原型-bean-的创建">Spring 中原型 bean 的创建</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-3">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#六、策略模式-strategy-pattern">六、策略模式（Strategy Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-4">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-中-bean-实例化策略">Spring 中 bean 实例化策略</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-中-aop-代理策略">Spring 中 AOP 代理策略</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tomcat-中-digester-解析-server-xml">Tomcat 中 Digester 解析 server.xml</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-4">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#七、门面模式-facade-pattern">七、门面模式（Facade Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-5">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#模板引擎-velocity-中门面模式使用">模板引擎 Velocity 中门面模式使用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-5">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#八、装饰器模式-decorator-pattern">八、装饰器模式（Decorator Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-6">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-中-beandefinitiondecorator">Spring 中 BeanDefinitionDecorator</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#commons-collections-包中-listutils">commons-collections 包中 ListUtils</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-6">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#九、适配器模式-adapter-pattern">九、适配器模式（Adapter Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-7">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-中-methodinterceptor-适配器">Spring 中 MethodInterceptor 适配器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-7">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#十、模板方法模式-template-pattern">十、模板方法模式（Template Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-8">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ibatis2-中-abstractdaotemplate">ibatis2 中 AbstractDAOTemplate</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tomcat-中-digester-里面的-rule">Tomcat 中 Digester 里面的 Rule</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tomcat-中-endpoint">Tomcat 中 Endpoint</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-8">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#十一、建造者模式-builder-pattern">十一、建造者模式（Builder Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-9">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#mybatis-中的-sqlsessionfactorybuilder">Mybatis 中的 SqlSessionFactoryBuilder</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-9">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#十二、观察者模式-observer-pattern">十二、观察者模式（Observer Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-10">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-中-applicationlistener">Spring 中 ApplicationListener</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-10">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#十三、命令模式-command-pattern">十三、命令模式（Command Pattern）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#介绍-11">介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tomcat-中命令模式">Tomcat 中命令模式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景-11">使用场景</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#总结">总结</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="说说常用开源框架中设计模式使用分析" tabindex="-1"><a class="header-anchor" href="#说说常用开源框架中设计模式使用分析"><span>说说常用开源框架中设计模式使用分析</span></a></h1><h2 id="一、前言" tabindex="-1"><a class="header-anchor" href="#一、前言"><span>一、前言</span></a></h2><p>设计模式代表了软件设计的最佳实践，是经过不断总结提炼出来的代码设计经验的分类总结，这些模式或者可以简化代码，或者可以是代码逻辑开起来清晰，或者对功能扩展很方便</p><p>设计模式按照使用场景可以分为三大类：</p><ul><li><p>创建型模式（Creational Patterns）：对对象的实例化过程进行抽象，这使得一个系统可以不用关心这些对象是如何创建，组合，呈现的，对于类创建模式来说通过使用继承改变实例化的类，对于对象创建模式来说通过使用代理来实例化所需要的对象。</p><ul><li>工厂模式</li><li>原型模式</li><li>构建者模式</li><li>单例模式</li></ul></li><li><p>结构型模式（Structural Patterns）：通过对多个类和对象进行组合得到复杂结构的类，一般使用继承继承或者成员变量引用形式来实现。</p><ul><li>适配器模式</li><li>桥接模式</li><li>过滤器模式</li><li>组合模式</li><li>装饰者模式</li><li>门面模式</li><li>享元模式</li><li>代理模式</li></ul></li><li><p>行为型模式（Behavioral Patterns）：行为模式不仅表达了对象和类，还表达了他们之间的交互，涉及到了对象和算法的分配。</p><ul><li>责任链模式</li><li>命令模式</li><li>解释器模式</li><li>迭代器模式</li><li>中介者模式</li><li>备忘录模式</li><li>观察者模式</li><li>状态模式</li><li>空对象模式</li><li>策略模式</li><li>模板方法模式</li><li>访问者模式</li></ul></li></ul><h2 id="二、责任链设计模式-chain-of-responsibility-pattern" tabindex="-1"><a class="header-anchor" href="#二、责任链设计模式-chain-of-responsibility-pattern"><span>二、责任链设计模式（Chain of Responsibility Pattern）</span></a></h2><h3 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h3><p>责任链模式是把多个对象串联起来形成一个链状结构，让每个对象都有机会对事件发送者的请求进行处理。责任链模式是设计模式中的行为模式，设计意图是为了使事件发送者和事件接受者之间解耦。通常责任链链中的每个对象都有下一个对象的引入（例如 <code>Tomcat</code> 里面 <code>StandardPipeline</code> 用来管理 <code>valve</code>），或者有个同一个链管理工厂里面使用数组存放了所有的对象（例如 <code>Tomcat</code> 里面 <code>ApplicationFilterChain</code> 用来关系 <code>filter</code>）。</p><h3 id="tomcat-中-valve-链" tabindex="-1"><a class="header-anchor" href="#tomcat-中-valve-链"><span>Tomcat 中 Valve 链</span></a></h3><p>Tomcat 中 <code>StandardEngine</code>, <code>StandardHost</code>, <code>StandardContext</code> 里面都有自己 <code>StandardPipeline</code>,下面以 <code>StandardEngine</code> 里面 <code>StandardPipeline</code> 为例讲解</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-bf812e77605ba1a3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>从上面类图可知道每个 <code>Valve</code> 都要继承 <code>ValveBase</code> 类，该类里面有一个 <code>Valve</code> 的引用，实际是链中下一个节点对象，<code>Valve</code> 就是通过每个 <code>Valve</code> 里面的 <code>next</code> 串联为链的。</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-51ec28c227c785bd.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>每个 <code>valve</code> 的 <code>invoke</code> 方法里面调用 <code>next.invoke</code> 激活链中下一个节点,并且 <code>StandardEngine</code>, <code>StandardHost</code>, <code>StandardContext</code> 都有一个<code> basic valve</code> 这个 <code>valve</code> 在链的末尾用来激活子容器的 valve 链。</p><h3 id="tomcat-中-filter-链" tabindex="-1"><a class="header-anchor" href="#tomcat-中-filter-链"><span>Tomcat 中 Filter 链</span></a></h3><p>Tomcat 中 <code>Filter</code> 链是使用 <code>ApplicationFilterChain</code> 来管理的，具体结构如下图：</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-a7ecb943aa15c858.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>可知 <code>Filter</code> 链不是像 <code>Valve</code> 一样在内部维护下个节点的引用，而是在 <code>ApplicationFilterChain</code> 中搞了个数组存放所有的 <code>Filter</code>，并通过 <code>n</code> 统计 <code>Filter</code> 总个数，<code>pos</code> 是当前 <code>filter</code> 的下标。</p><p><code>ApplicationFilterChain</code> 的 <code>doFilter</code> 代码如下：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ServletRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ServletResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> response)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        throws IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ServletException {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        internalDoFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">response)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> internalDoFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ServletRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ServletResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> response) throws IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ServletException {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Call the next filter if there is one</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (pos </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> n) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            //获取filter链中下标为pos的filter</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            ApplicationFilterConfig</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> filterConfig </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> filters[pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            Filter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> filter </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                filter </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> filterConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                support</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fireInstanceEvent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">InstanceEvent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">BEFORE_FILTER_EVENT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          filter, request, response);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isAsyncSupported</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;false&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">equalsIgnoreCase</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                        filterConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getFilterDef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAsyncSupported</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                    request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Globals</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ASYNC_SUPPORTED_ATTR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                            Boolean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">FALSE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                //调用自定义filter的dofilter方法</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                filter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">doFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request, response, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                support</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fireInstanceEvent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">InstanceEvent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">AFTER_FILTER_EVENT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          filter, request, response);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            } </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ....</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   .....</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用场景" tabindex="-1"><a class="header-anchor" href="#使用场景"><span>使用场景</span></a></h3><ul><li>当一个请求需要根据请求参数的不同由不同对象来处理时候。</li><li>当一个请求需要固定对象顺序处理，并且可扩展性的在固定顺序里面插入新的对象进行处理时候。</li></ul><h2 id="三、工厂模式-factory-pattern" tabindex="-1"><a class="header-anchor" href="#三、工厂模式-factory-pattern"><span>三、工厂模式（Factory Pattern）</span></a></h2><h3 id="介绍-1" tabindex="-1"><a class="header-anchor" href="#介绍-1"><span>介绍</span></a></h3><p>工厂模式是创建型模式，他封装了对象的创建过程，调用者使用具体的工厂方法根据参数就可以获取对应的对象。</p><h3 id="spring-框架中-beanfactory" tabindex="-1"><a class="header-anchor" href="#spring-框架中-beanfactory"><span>Spring 框架中 BeanFactory</span></a></h3><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-2d102832375148ef.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图 <code>BeanFactory</code> 接口提供了 <code>getBean</code> 方法，在 <code>AbstractBeanFactory</code> 中实现了该方法，经过层层继承，实现，最后 <code>DefaultListableBeanFactory</code> 实现了 <code>BeanDefinitionRegistry</code> 接口用来保存 <code>bean</code> 定义，继承了 <code>AbstractAutowireCapableBeanFactory</code> 用来支撑 <code>autowired</code>。</p><h3 id="举个例子" tabindex="-1"><a class="header-anchor" href="#举个例子"><span>举个例子</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> testBeanFactoy</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() throws NamingException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> SQLException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ParseException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> IOException {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 创建 Bean 工厂</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    DefaultListableBeanFactory</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bf </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> DefaultListableBeanFactory</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 给 Bean 工厂添加 Bean 定义, 解析 xml 里面的 Bean 放入 Bean 工厂</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    loadBeanDefinitions</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(bf)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 根据名字从 Bean 工厂获取 Bean</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Hello</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> hello </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (Hello) </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;hello&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    hello</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sayHello</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Hello2</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> hello2 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (Hello2) </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;hello2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    hello2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sayHello</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">protected</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> loadBeanDefinitions</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">DefaultListableBeanFactory</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> beanFactory) throws IOException {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    XmlBeanDefinitionReader</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> beanDefinitionReader </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> XmlBeanDefinitionReader</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanFactory)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">[] configLocations </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[] { </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;beans2.xml&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> }</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (configLocations </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        beanDefinitionReader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">loadBeanDefinitions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(configLocations);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用场景-1" tabindex="-1"><a class="header-anchor" href="#使用场景-1"><span>使用场景</span></a></h3><ul><li>不同条件下创建不同实例，用于统一管理 <code>Bean</code></li><li>不同条件下调用不同工厂方法获取不同场景下的 <code>Bean</code></li></ul><h2 id="四、单例设计模式-singleton-pattern" tabindex="-1"><a class="header-anchor" href="#四、单例设计模式-singleton-pattern"><span>四、单例设计模式（Singleton Pattern）</span></a></h2><h3 id="介绍-2" tabindex="-1"><a class="header-anchor" href="#介绍-2"><span>介绍</span></a></h3><p>单例模式是一种创建型模式，单例模式提供一个创建对象的接口，但是多次调用该接口返回的是同一个实例的引用，目的是为了保证只有一个实例，并且提供一个访问这个实例的统一接口。</p><h3 id="spring-中单例-bean-的创建" tabindex="-1"><a class="header-anchor" href="#spring-中单例-bean-的创建"><span>Spring 中单例 <code>Bean</code> 的创建</span></a></h3><p>Spring 中默认配置的 <code>bean</code> 的 <code>scope</code> 为 <code>singleton</code>，也就是单例作用域。那么看看它是如何做到的。在 <code>AbstractBeanFactory</code> 类里面的 <code>doGetBean</code> 方法：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">protected</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doGetBean</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> requiredType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[] args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> typeCheckOnly) throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> beanName </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> transformedBeanName</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(name)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bean </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 解决set循环依赖</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> sharedInstance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getSingleton</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (sharedInstance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> args </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    else</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // 创建单件bean.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mbd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isSingleton</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            sharedInstance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getSingleton</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ObjectFactory</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BeansException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                    try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                        return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createBean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(beanName, mbd, args);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                    catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">BeansException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    ...</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                        throw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ex;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            })</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            bean </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getObjectForBeanInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(sharedInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> beanName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> mbd)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">       //创建原型bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mbd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isPrototype</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        //创建request作用域bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        else</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ...</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>getSingleton</code> 代码：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getSingleton</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> beanName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ObjectFactory</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> singletonFactory) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    Assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">notNull</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(beanName, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&#39;beanName&#39; must not be null&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    synchronized</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">singletonObjects</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Object</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> singletonObject </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">singletonObjects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(beanName);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (singletonObject </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            beforeSingletonCreation</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ...</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                singletonObject </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> singletonFactory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">BeanCreationException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            finally</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (recordSuppressedExceptions) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                    this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">suppressedExceptions</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                afterSingletonCreation</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            addSingleton</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> singletonObject)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (singletonObject </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> NULL_OBJECT </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> singletonObject </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">protected</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> addSingleton</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> beanName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> singletonObject) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    synchronized</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">singletonObjects</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">singletonObjects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(beanName, (singletonObject </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> singletonObject </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NULL_OBJECT));</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">singletonFactories</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">remove</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(beanName);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">earlySingletonObjects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">remove</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(beanName);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">registeredSingletons</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(beanName);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Map</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> singletonObjects </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> CollectionFactory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createConcurrentMapIfPossible</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可知 Spring 内部四通过一个 <code>ConcurrentMap</code> 来管理单件 <code>bean</code> 的。获取 <code>bean</code> 时候会先看看 <code>singletonObjects</code> 中是否有，有则直接返回，没有则创建后放入。</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-3013e4bf12ef0274.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Spring 的 <code>bean</code> 工厂管理的单例模式管理的是多个 <code>bean</code> 实例的单例，是工厂模式管理所有的 <code>bean</code>,而每个 <code>bean</code> 的创建又使用了单例模式。</p><h3 id="使用场景-2" tabindex="-1"><a class="header-anchor" href="#使用场景-2"><span>使用场景</span></a></h3><ul><li>同一个 <code>JVM</code> 应用的不同模块需要使用同一个对象实例进行信息共享。</li><li>需要同一个实例来生成全局统一的序列号</li></ul><h2 id="五、原型设计模式-prototype-pattern" tabindex="-1"><a class="header-anchor" href="#五、原型设计模式-prototype-pattern"><span>五、原型设计模式（Prototype Pattern）</span></a></h2><h3 id="介绍-3" tabindex="-1"><a class="header-anchor" href="#介绍-3"><span>介绍</span></a></h3><p>相比单例设计模式，原型模式是每次创建一个对象，下面看下 Spring 是如何使用原型模式的</p><h3 id="spring-中原型-bean-的创建" tabindex="-1"><a class="header-anchor" href="#spring-中原型-bean-的创建"><span>Spring 中原型 <code>bean</code> 的创建</span></a></h3><p>创建原型 <code>bean</code> 需要在 <code>xml</code> 特别说明：</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;hello&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com.lusifer.demo.Hello&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> scope</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;prototype&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">protected</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">T</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doGetBean</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Class</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">T</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> requiredType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[] args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> typeCheckOnly)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        throws BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> beanName </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> transformedBeanName</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(name)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Eagerly check singleton cache for manually registered singletons.</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> sharedInstance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getSingleton</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (sharedInstance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> args </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    else</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // Create bean instance.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mbd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isSingleton</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            //创建原型bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mbd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isPrototype</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // It&#39;s a prototype -&gt; create a new instance.</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">                Object</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> prototypeInstance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                    beforePrototypeCreation</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                    prototypeInstance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createBean</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> mbd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> args)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                finally</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                    afterPrototypeCreation</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">                bean </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getObjectForBeanInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(prototypeInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> beanName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> mbd)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            else</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">BeansException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            cleanupAfterBeanCreationFailure</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(beanName)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ...</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (T) bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>createBean</code> 函数里面则是根据 <code>bean</code> 定义创建新 <code>bean</code>，感兴趣的可以看看。</p><h3 id="使用场景-3" tabindex="-1"><a class="header-anchor" href="#使用场景-3"><span>使用场景</span></a></h3><p>当有业务场景使用某个 <code>bean</code> 时候需要使用自己的一个拷贝的时候使用。</p><h2 id="六、策略模式-strategy-pattern" tabindex="-1"><a class="header-anchor" href="#六、策略模式-strategy-pattern"><span>六、策略模式（Strategy Pattern）</span></a></h2><h3 id="介绍-4" tabindex="-1"><a class="header-anchor" href="#介绍-4"><span>介绍</span></a></h3><p>策略模式属于行为性模式，它定义一系列的算法对象,使用时候可以使它们相互替换。</p><h3 id="spring-中-bean-实例化策略" tabindex="-1"><a class="header-anchor" href="#spring-中-bean-实例化策略"><span>Spring 中 <code>bean</code> 实例化策略</span></a></h3><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-24f08d52b6fc7fba.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>从图知道：接口 <code>InstantiationStrategy</code> 是实例化策略接口类，它定义了三个实例化接口，然后 <code>SimpleInstantiationStrategy</code> 实现了该策略，它主要做一些简单的根据构造函数实例号 <code>bean</code> 的工作，然后 <code>CglibSubclassingInstantiationStrategy</code> 又继承了 <code>SimpleInstantiationStrategy</code> 新增了方法注入方式根据 <code>cglib</code> 生成代理类实例化方法。</p><p>在 <code>AbstractAutowireCapableBeanFactory</code> 中管理了该策略的一个对象，默认是 <code>CglibSubclassingInstantiationStrategy</code> 策略，运行时候可以通过 <code>setInstantiationStrategy</code> 改变实例化策略，如果你自己写个个策略的话。</p><h3 id="spring-中-aop-代理策略" tabindex="-1"><a class="header-anchor" href="#spring-中-aop-代理策略"><span>Spring 中 AOP 代理策略</span></a></h3><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-7e0b0badc2deef53.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>首先看 <code>AopProxyFactory</code> 接口类提供了 <code>createAopProxy</code> 接口，这个是策略模式的接口方法。然后 <code>DefaultAopProxyFactory</code> 实现了该接口作为策略的实现者。然后 <code>ProxyCreatorSupport</code> 里面引用了 <code>AopProxyFactory</code>，并且提供了 <code>get</code>, <code>set</code> 方法用来运行时改变策略，这里 Spring 只实现了 <code>DefaultAopProxyFactory</code> 这一个策略，如果需要自己也可以写个。</p><p><code>DefaultAopProxyFactory</code> 里面的 <code>createAopProxy</code> 的逻辑如下，可以在运行时根据参数决定用 <code>Cglib</code> 策略还是 <code>JDK动态代理</code> 策略生成代理类：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AopProxy</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createAopProxy</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">AdvisedSupport</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> config) throws AopConfigException {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 如果 XML 打开了优化开关，或者设置为了代理目标类，或者目前类没有接口</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isOptimize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isProxyTargetClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> hasNoUserSuppliedProxyInterfaces</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(config)) {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Class</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> targetClass </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getTargetClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (targetClass </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> AopConfigException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;TargetSource cannot determine target class: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    &quot;Either an interface or a target is required for proxy creation.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // 如果有接口，或者通过 Proxy.newProxyInstance 生成的，则使用 JDK动态代理</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">targetClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Proxy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isProxyClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(targetClass)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> JdkDynamicAopProxy</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(config)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // 使用 CGLIB</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ObjenesisCglibAopProxy</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(config)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    else</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // 使用 JDK动态代理</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> JdkDynamicAopProxy</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(config)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外 <code>AopProxy</code> 也是一个策略接口类，具体实现的策略为 <code>JdkDynamicAopProxy</code>，<code>CglibAopProxy</code>，<code>ObjenesisCglibAopProxy</code></p><h3 id="tomcat-中-digester-解析-server-xml" tabindex="-1"><a class="header-anchor" href="#tomcat-中-digester-解析-server-xml"><span>Tomcat 中 <code>Digester</code> 解析 <code>server.xml</code></span></a></h3><p>Tomcat 中的 <code>Digester</code> 是为了解析 <code>server.xml</code> 的，其中每个元素都有一个解析规则就是 <code>Rule</code>，<code>DigestER</code> 一开始先指定不同的解析策略（<code>Rule</code>），然后在具体解析 <code>server.xml</code> 时候根据节点不同使用不同解析策略来解析节点。</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-2ef6c46b46d18914.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图在解析每个节点时候会先找到该节点对应的解析策略，然后循环去调用所有解析策略的方法去处理。</p><h3 id="使用场景-4" tabindex="-1"><a class="header-anchor" href="#使用场景-4"><span>使用场景</span></a></h3><p>运行时根据条件的不同使用不同的策略处理一个事情，与责任链不同在于，责任链是一个链条，一个事情可以被责任链里面所有节点处理，而 策略模式则是只有有一个对象来处理。</p><h2 id="七、门面模式-facade-pattern" tabindex="-1"><a class="header-anchor" href="#七、门面模式-facade-pattern"><span>七、门面模式（Facade Pattern）</span></a></h2><h3 id="介绍-5" tabindex="-1"><a class="header-anchor" href="#介绍-5"><span>介绍</span></a></h3><p>门面模式是一种结构性模式，它通过新增一个门面类对外暴露系统提供的一部分功能，或者屏蔽了内部系统的复杂性，对外部仅仅暴露一个简单的接口，或者通过调用不同的服务对外提供统一的接口，让使用者对这些内部服务透明化。</p><h3 id="模板引擎-velocity-中门面模式使用" tabindex="-1"><a class="header-anchor" href="#模板引擎-velocity-中门面模式使用"><span>模板引擎 Velocity 中门面模式使用</span></a></h3><p>Velocity 里面的 <code>VelocityEngine</code> 和 <code>Velocity</code> 类都是 <code>RuntimeInstance</code> 类的门面，后者提供了模板渲染的所有功能，前两者则是内部维护 <code>RuntimeInstance</code> 的实例，具体工作还是委托给 <code>RuntimeInstance</code> 来实现。</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-66c15140bfe5ad36.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图 <code>RuntimeInstance</code> 提供了 <code>Velocity</code> 引擎的所用功能，<code>VelocityEngine</code> 内部直接引用了 <code>RuntimeInstance</code> 的一个实例，<code>VelocityEngine</code> 对外暴露的服务都是委托 <code>RuntimeInstance</code> 实现，并且每次 <code>new</code> 一个 <code>VelocityEngine</code> 内部都会有 <code>RuntimeInstance</code> 的一个实例被创建。而 <code>Velocity</code> 类调用了单例模式类 <code>RuntimeSingleton</code> 里面的方法，<code>RuntimeSingleton</code> 又是 <code>RuntimeInstance</code> 的一个单例模式。</p><h3 id="使用场景-5" tabindex="-1"><a class="header-anchor" href="#使用场景-5"><span>使用场景</span></a></h3><ul><li>当需要对外屏蔽一个系统的复杂性时候可以考虑使用门面模式对外提供简单可读性高的接口类</li><li>当需要对外部暴露系统一部分权限的接口时候可以考虑使用门面模式减少系统权限。</li><li>当系统需要调用不同服务汇总后在对外提供服务时候可以考虑使用门面模式对外屏蔽细节，之暴露一个接口。</li></ul><h2 id="八、装饰器模式-decorator-pattern" tabindex="-1"><a class="header-anchor" href="#八、装饰器模式-decorator-pattern"><span>八、装饰器模式（Decorator Pattern）</span></a></h2><h3 id="介绍-6" tabindex="-1"><a class="header-anchor" href="#介绍-6"><span>介绍</span></a></h3><p>装饰器模式是一种结构性模式，它作用是对对象已有功能进行增强，但是不改变原有对象结构。这避免了通过继承方式进行功能扩充导致的类体系臃肿。</p><h3 id="spring-中-beandefinitiondecorator" tabindex="-1"><a class="header-anchor" href="#spring-中-beandefinitiondecorator"><span>Spring 中 BeanDefinitionDecorator</span></a></h3><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-f9a9a083d138e9d0.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图 <code>ScopedProxyBeanDefinitionDecorator</code> 实现了 <code>decorate</code> 方法用来对 <code>scope</code> 作用域为 <code>request</code> 的 <code>bean</code> 定义进行包装。具体时序图为：</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-cab488a963d04657.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ScopedProxyBeanDefinitionDecorator</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BeanDefinitionDecorator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> PROXY_TARGET_CLASS </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;proxy-target-class&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BeanDefinitionHolder</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> decorate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Node</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> node</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">BeanDefinitionHolder</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> definition</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ParserContext</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> parserContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        boolean</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> proxyTargetClass</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (node </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">instanceof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Element) {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            Element</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ele</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Element) node;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ele</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hasAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(PROXY_TARGET_CLASS)) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                proxyTargetClass </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Boolean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">valueOf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ele</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAttribute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(PROXY_TARGET_CLASS));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // 创建scoped的代理类，并注册到容器</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        BeanDefinitionHolder</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> holder</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                ScopedProxyUtils</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createScopedProxy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(definition, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">parserContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRegistry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), proxyTargetClass);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> targetBeanName</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ScopedProxyUtils</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getTargetBeanName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">definition</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBeanName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        parserContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getReaderContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fireComponentRegistered</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> BeanComponentDefinition</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">definition</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBeanDefinition</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), targetBeanName));</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> holder;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>关于 <code>ScopedProxyBeanDefinitionDecorator</code> 干啥用的呢：</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;lavaPvgInfo&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com.alibaba.lava.privilege.PrivilegeInfo&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    scope</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;request&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;aesKey&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;666&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">aop:scoped-proxy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其实就是处理 <code>&lt;aop:scoped-proxy /&gt;</code> 的，具体作用是包装 <code>lavaPvgInfo</code> 的 <code>bean</code> 定义为 <code>ScopedProxyFactoryBean</code>，作用是实现 <code>request</code> 作用域 <code>bean</code></p><h3 id="commons-collections-包中-listutils" tabindex="-1"><a class="header-anchor" href="#commons-collections-包中-listutils"><span>commons-collections 包中 ListUtils</span></a></h3><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-afa39758e0c2213d.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><code>ListUtils</code> 中的四个方法分别依赖 <code>list</code> 的四种装饰器类对 <code>List</code> 功能进行扩充和限制。</li><li>其中 <code>FixedSizeList</code> 类通过禁止 <code>add/remove</code> 操作保证 <code>list</code> 的大小固定，但是可以修改元素内容</li><li>其中 <code>UnmodifiableList</code> 类通过禁用 <code>add</code>, <code>clear</code>, <code>remove</code>, <code>set</code>,保证 <code>list</code> 的内容不被修改</li><li>其中 <code>SynchronizedList</code> 类通过使用 <code>Lock</code> 来保证 <code>add</code>, <code>set</code>, <code>get</code>, <code>remove</code> 等的同步安全</li><li>其中 <code>LazyList</code> 类则当调用 <code>get</code> 方法发现 <code>list</code> 里面不存在对象时候，自动使用 <code>factory</code> 创建对象.</li></ul><h3 id="使用场景-6" tabindex="-1"><a class="header-anchor" href="#使用场景-6"><span>使用场景</span></a></h3><p>在不改变原有类结构基础上，新增或者限制或者改造功能时候。</p><h2 id="九、适配器模式-adapter-pattern" tabindex="-1"><a class="header-anchor" href="#九、适配器模式-adapter-pattern"><span>九、适配器模式（Adapter Pattern）</span></a></h2><h3 id="介绍-7" tabindex="-1"><a class="header-anchor" href="#介绍-7"><span>介绍</span></a></h3><p>适配器模式属于结构性模式，它为两个不同接口之间互通提供了一种手段。</p><h3 id="spring-中-methodinterceptor-适配器" tabindex="-1"><a class="header-anchor" href="#spring-中-methodinterceptor-适配器"><span>Spring 中 MethodInterceptor 适配器</span></a></h3><p>在 Spring Aop 框架中，<code>MethodInterceptor</code> 接口被用来拦截指定的方法，对方法进行增强。</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-5eacbfe80fc60237.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>大家都知道在 <code>AOP</code> 中每个 <code>advistor</code> 里面会有一个 <code>advice</code> 具体做切面动作，Spring 提供了 <code>AspectJAfterReturningAdvice</code>，<code>AspectJMethodBeforeAdvice</code>，<code>AspectJAroundAdvice</code>，<code>AspectJAfterAdvice</code> 这几个 <code>advice</code>,在 <code>XML</code> 配置 <code>AOP</code> 时候会指定 <code>&lt;aop:after-returning/&gt;</code>, <code>&lt;aop:before/&gt;</code>, <code>&lt;aop:around/&gt;</code>, <code>&lt;aop:after/&gt;</code>, 其实内部就是创建上面对应的这些 <code>advice</code>。</p><p>从图知道 <code>AspectJAfterReturningAdvice</code> 和 <code>AspectJMethodBeforeAdvice</code> 没有实现 <code>MethodInterceptor</code> 接口，其他两者则实现了该接口。而 Spring Aop 的方法拦截器却必须是实现了 <code>MethodInterceptor</code> 的，所以 Spring 提供了对应的适配器来适配这个问题,分别是 <code>MethodBeforeAdviceAdapter</code> 和 <code>AfterReturningAdviceAdapter</code> 和 <code>ThrowsAdviceAdapter</code>。</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-072d44bda8af7ef9.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>看下 <code>DefaultAdvisorAdapterRegistry</code> 的 <code>getInterceptors</code> 方法：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MethodInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[] </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getInterceptors</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Advisor</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> advisor) throws UnknownAdviceTypeException {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MethodInterceptor</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> interceptors </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MethodInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    //从advistor中获取advice</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Advice</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> advice </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> advisor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAdvice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    //如果实现了MethodInterceptor则直接加入，比如AspectJAroundAdvice，AspectJAfterAdvice</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (advice </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">instanceof</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> MethodInterceptor) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        interceptors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">((MethodInterceptor) advice);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    //否者看是否有当前advice的适配器，首先检验是否支持，支持则返回对应的适配器</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">AdvisorAdapter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> adapter </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">adapters</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">adapter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supportsAdvice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(advice)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            interceptors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">adapter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(advisor));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">interceptors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isEmpty</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UnknownAdviceTypeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">advisor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAdvice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> interceptors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toArray</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MethodInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">interceptors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()]);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以 <code>MethodBeforeAdviceAdapter</code> 为例子看下：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MethodBeforeAdviceAdapter</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AdvisorAdapter</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Serializable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> supportsAdvice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Advice</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (advice </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">instanceof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MethodBeforeAdvice);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MethodInterceptor</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Advisor</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> advisor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        MethodBeforeAdvice</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> advice</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (MethodBeforeAdvice) </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">advisor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAdvice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> MethodBeforeAdviceInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(advice);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MethodBeforeAdviceInterceptor</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MethodInterceptor</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Serializable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MethodBeforeAdvice</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Create a new MethodBeforeAdviceInterceptor for the given advice.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> advice</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> the MethodBeforeAdvice to wrap</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> MethodBeforeAdviceInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MethodBeforeAdvice</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        Assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">notNull</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(advice, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Advice must not be null&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">advice</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> advice;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> invoke</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MethodInvocation</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> mi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Throwable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">advice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">before</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getArguments</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getThis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() );</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">proceed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可知 <code>MethodBeforeAdviceInterceptor</code> 继承了 <code>MethodInterceptor</code> 作为了一个适配器内部委托请求给 <code>MethodBeforeAdvice</code>。</p><h3 id="使用场景-7" tabindex="-1"><a class="header-anchor" href="#使用场景-7"><span>使用场景</span></a></h3><ul><li>两个系统交互时候由于接口参数不一样没办法直接对接，则可以搞个适配器接口做参数转换。</li><li>适配器模式经常是在一个系统或者设计已经定型时候用的，而不是在初始设计时候。一般是因为不影响现在业务情况下，通过适配方式统一接口</li></ul><h2 id="十、模板方法模式-template-pattern" tabindex="-1"><a class="header-anchor" href="#十、模板方法模式-template-pattern"><span>十、模板方法模式（Template Pattern）</span></a></h2><h3 id="介绍-8" tabindex="-1"><a class="header-anchor" href="#介绍-8"><span>介绍</span></a></h3><p>模板设计模式是一种行为设计模式，它使用一个抽象类定义了一个模板，这个模板里面定义了一系列的接口，子类则只需要继承该抽象类并且根据需要重写一部分接口。</p><h3 id="ibatis2-中-abstractdaotemplate" tabindex="-1"><a class="header-anchor" href="#ibatis2-中-abstractdaotemplate"><span>ibatis2 中 AbstractDAOTemplate</span></a></h3><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-27b737718c1a71bc.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图 <code>AbstractDAOTemplate</code> 是抽象模板类，里面定义了 <code>configure</code> 方法，<code>configure</code> 方法里面定义了好多 <code>protected</code> 方法，其中就有些是抽象方法。类 <code>SpringDAOTemplate</code>，<code>IbatisDAOTemplate</code>，<code>GenericCIDAOTemplate</code>，<code>GenericSIDAOTemplate</code> 则继承了 <code>AbstractDAOTemplate</code> 类并重写了一部分方法。</p><h3 id="tomcat-中-digester-里面的-rule" tabindex="-1"><a class="header-anchor" href="#tomcat-中-digester-里面的-rule"><span>Tomcat 中 Digester 里面的 Rule</span></a></h3><p>Tomcat 中的 <code>Digester</code> 是为了解析 <code>server.xml</code> 的，其中每个元素都有一个解析规则就是 <code>Rule</code> ,类图如下：</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-d5e4f335d709ab29.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图：Rule 是抽象类，对于每个解析的节点来说 Rule 提供了解析所需所有的方法，而他的子类则根据自己的特殊性重写一部分方法来支持自己的特性。</p><h3 id="tomcat-中-endpoint" tabindex="-1"><a class="header-anchor" href="#tomcat-中-endpoint"><span>Tomcat 中 Endpoint</span></a></h3><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-bd4bb3f72e7da976.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图 <code>AbstractEndpoint</code> 是个抽象类，定义了 <code>Endpoint</code> 的所有接口，然后 <code>JIoEndpoint</code> 继承了该类并且重写了一部分重要的方法实现了 <code>BIO</code> 方式 <code>endpoint</code> , <code>NioEndpoint</code> 则重写了方法实现了 <code>NIO</code> 的 <code>endpoint</code>.</p><h3 id="使用场景-8" tabindex="-1"><a class="header-anchor" href="#使用场景-8"><span>使用场景</span></a></h3><p>当多个子类具有共同的操作流程逻辑，并且其中某些流程节点操作需要自己定制化时候。</p><h2 id="十一、建造者模式-builder-pattern" tabindex="-1"><a class="header-anchor" href="#十一、建造者模式-builder-pattern"><span>十一、建造者模式（Builder Pattern）</span></a></h2><h3 id="介绍-9" tabindex="-1"><a class="header-anchor" href="#介绍-9"><span>介绍</span></a></h3><p>建造者模式是一种创建型模式，将一个复制对象的创建屏蔽到接口内部，用户使用时候只需要传递固定的参数，内部就会执行复杂逻辑后返回会用户需要的对象，用户不需要知道创建的细节。</p><h3 id="mybatis-中的-sqlsessionfactorybuilder" tabindex="-1"><a class="header-anchor" href="#mybatis-中的-sqlsessionfactorybuilder"><span>Mybatis 中的 SqlSessionFactoryBuilder</span></a></h3><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-96342ae1a578c8c6.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图 <code>MyBaits</code> 中的 <code>SqlSessionFactoryBuilder</code> 就是典型的创建者模式，他内部有多个 <code>build</code> 方法，根据参数的不同创建出 <code>SqlSessionFactory</code> 对象，使用者只需要传递具体参数而不用关系内部是如何创建出需要的对象的。<code>SqlSessionFactoryBean</code> 大家应该很熟悉，在 <code>xml</code> 里面配置的。</p><h3 id="使用场景-9" tabindex="-1"><a class="header-anchor" href="#使用场景-9"><span>使用场景</span></a></h3><p>当一个对象比较复杂并且容易出错时候，可以考虑这种模式去屏蔽创造细节。</p><h2 id="十二、观察者模式-observer-pattern" tabindex="-1"><a class="header-anchor" href="#十二、观察者模式-observer-pattern"><span>十二、观察者模式（Observer Pattern）</span></a></h2><h3 id="介绍-10" tabindex="-1"><a class="header-anchor" href="#介绍-10"><span>介绍</span></a></h3><p>观察者模式是一种行为模式，它定义了当一个对象的状态或者属性发生变化时候，通通知其他对这些状态感兴趣的对象。观察者模式也叫发布-订阅模式，就是说当你订阅了摸一个主体时候，如果发布者改变了主题内容，那么所有订阅这个主体者都会受到通知。</p><h3 id="spring-中-applicationlistener" tabindex="-1"><a class="header-anchor" href="#spring-中-applicationlistener"><span>Spring 中 ApplicationListener</span></a></h3><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-eee8a0c0437a83d5.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图 黄色部分的 <code>listener</code> 们可以认为是订阅者，红色的 <code>context</code> 是发布者，<code>context</code> 在 <code>IOC</code> 不同状态会给这些订阅者发布不同的消息通知订阅者容器状态。蓝色的为具体的事件（这里为容器不同状态），其中 <code>ContextRefreshedEvent</code> 是 <code>IOC</code> 刷新完成（也就是 <code>bean</code> 解析完成，创建完毕并且 <code>autowired</code> 完成）后的事件这个经常用。 。这里 <code>context</code> 并不是直接来管理黄色的 <code>listener</code> 订阅者的，而是委托给了绿色的部分，该部分是可以增加删除订阅者，并且发布事件给订阅者。</p><p>其实 Tomcat 中的 <code>Lifecycle</code> 也是这种机制</p><h3 id="使用场景-10" tabindex="-1"><a class="header-anchor" href="#使用场景-10"><span>使用场景</span></a></h3><p>满足发布-订阅条件的，当一个对象状态或者属性变化，需要把这种变化通知到订阅者时候。</p><h2 id="十三、命令模式-command-pattern" tabindex="-1"><a class="header-anchor" href="#十三、命令模式-command-pattern"><span>十三、命令模式（Command Pattern）</span></a></h2><h3 id="介绍-11" tabindex="-1"><a class="header-anchor" href="#介绍-11"><span>介绍</span></a></h3><p>命令模式是一种行为模式，通过把命令封装为一个对象，命令发送者把命令对象发出后，就不去管是谁来接受处理这个命令，命令接受者接受到命令对象后进行处理，也不用管命令是谁发出的，所以命令模式实现了发送者与接受者之间的解耦，而具体把命令发送给谁还需要一个控制器。</p><h3 id="tomcat-中命令模式" tabindex="-1"><a class="header-anchor" href="#tomcat-中命令模式"><span>Tomcat 中命令模式</span></a></h3><p>Tomcat 作为一个服务器本身会接受外部大量请求，当一个请求过来后 Tomcat 根据域名去找对应的 <code>host</code>,找到 <code>host</code> 后会根据应用名去找具体的 context(应用)，然后具体应用处理请求。对于具体 <code>host</code> 来说他不关心这个请求是谁给的，对应请求来说他不必关心谁来处理，但是两者是通过 <code>request</code> 封装请求对象进行关联起来。</p><figure><img src="http://114.116.184.67:81/images/designmodel/5879294-f9e90281b20fe688.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Tomcat 中 <code>Connector</code> 作为命令发出者，<code>Connector</code> 接受到请求后把请求内容封装为 <code>request</code> 对象（命令对象），然后使用 <code>CoyoteAdapter</code> 作为分发器把请求具体发配到具体的 <code>host</code>, <code>host</code> 在根据 <code>request</code> 对象找到具体的 <code>context</code>,至此找到了具体的应用，交给具体应用处理。</p><p>另外对于使用 <code>SpringMVC</code> 的应用来说，上面找到具体应用，但是具体交给那个 <code>controller</code> 来处理那，这是不是也是命令模式的使用那。</p><h3 id="使用场景-11" tabindex="-1"><a class="header-anchor" href="#使用场景-11"><span>使用场景</span></a></h3><p>当事件发送者和接受者直接需要完全解耦（直接并不存在引用关系）时候。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><p>设计模式中每一个模式都描述了在我们工作中不断重复发生的问题，以及问题的解决方案，所以真正掌握设计模式可以避免我们做不必要的重复劳动。</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/cangbaoy/docs.github.io/edit/main/src/exambook/Java-Design-Model1.md" aria-label="编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: yph0228@163.com">him</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/exambook/javabasics6.html" aria-label="说说反射的用途及实现"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->说说反射的用途及实现</div></a><a class="route-link auto-link next" href="/exambook/Java-Design-Ability6.html" aria-label="说说概要设计"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">说说概要设计<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><!----></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.e84162b8.js" defer></script><script src="/assets/js/4893.6b2ef6da.js" defer></script><script src="/assets/js/app.bb7342ad.js" defer></script>
  </body>
</html>
